<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Page</title>
    <!-- <link rel="stylesheet" href="./src/css/style.css"> -->

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />

    <style>
      :root {
        --background: #333;
        --primary-color: #444;
        --secondary-color: #555;
        --text-color: #fff;
        --border-color: #666;
        --input-border-color: #777;
      }

      body {
        background: var(--background);
        font-family: Arial, sans-serif;
        color: var(--text-color);
        margin: 0;
        padding: 0;
      }

      .profile-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 50px auto;
        width: 500px;
        padding: 20px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        background: var(--primary-color);
        position: relative;
      }

      .profile-info {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }

      .profile-info img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 20px;
        border: 1px solid var(--border-color);
      }

      .user-details p {
        margin-bottom: 10px;
      }

      .user-details span {
        font-weight: bold;
      }

      #update-button,
      #cancel-button,
      #logout-button {
        padding: 10px 20px;
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin: 5px;
      }

      #update-button:hover,
      #cancel-button:hover,
      #logout-button:hover {
        background-color: darken(var(--secondary-color), 10%);
      }

      #update-form {
        width: 100%;
        display: none;
        padding: 20px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        margin-top: 20px;
        background: var(--primary-color);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        transition: opacity 0.3s ease;
      }

      #update-form label {
        display: block;
        margin-bottom: 5px;
      }

      #update-form input,
      #update-form textarea {
        padding: 10px;
        width: calc(100% - 22px);
        border: 1px solid var(--input-border-color);
        border-radius: 5px;
        margin-bottom: 15px;
        background: var(--background);
        color: var(--text-color);
      }

      #update-form button[type="submit"] {
        padding: 10px 20px;
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      #update-form button[type="submit"]:hover {
        background-color: darken(var(--secondary-color), 10%);
      }

      #profileBackBtn > span {
        position: absolute;
        top: 15px;
        left: 5%;
        z-index: 999;
        cursor: pointer;
        border: 2px solid #fff;
        border-radius: 50%;
        padding: 5px;
      }

      #mainContainer {
        max-width: 1600px;
        margin: auto;
      }
    </style>
  </head>

  <body>
    <section id="mainContainer">
      <div class="profile-container">
        <div id="profileBackBtn">
          <span
            onclick="window.location.href='index.html'"
            class="material-symbols-outlined"
          >
            arrow_back
          </span>
        </div>

        <h1>My Profile</h1>
        <div class="profile-info">
          <img
            src="https://media.licdn.com/dms/image/C4D03AQFA9zzNa2zOsg/profile-displayphoto-shrink_200_200/0/1644760685717?e=1723680000&v=beta&t=qzO69q_9jgQ8TH2N-Wa4eGmgOVvc-Iqx2h6llR_clBw"
            alt="Profile Picture"
          />
          <div class="user-details">
            <p>Name: <span id="name">John Doe</span></p>
            <p>Phone: <span id="phone">09877309271</span></p>
            <p>Address: <span id="address">add</span></p>
            <!-- <p>Bio: <span id="bio">A short bio about myself.</span></p> -->
          </div>
        </div>
        <button id="update-button">Edit Profile</button>
        <button id="logout-button">Logout</button>
        <button id="cancel-button" style="display: none">Cancel</button>
        <form id="update-form">
          <label for="name-input">Name:</label>
          <input type="text" id="name-input" name="name" />
          <label for="password-input">Password:</label>
          <input type="password" id="password-input" name="password" />
          <label for="phone-input">Phone:</label>
          <input type="text" id="phone-input" name="phone" />
          <label for="address-input">Address:</label>
          <input type="text" id="address-input" name="address" />
          <!-- <label for="bio-input">Bio:</label>
            <textarea id="bio-input" name="bio"></textarea> -->
          <button type="submit">Save Changes</button>
        </form>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const updateButton = document.getElementById("update-button");
        const cancelButton = document.getElementById("cancel-button");
        const logoutButton = document.getElementById("logout-button");
        const updateForm = document.getElementById("update-form");

        // Replace with your JSON server URL
        const API_URL = "http://localhost:3000/users"; // <--- Change this to your JSON server users endpoint

        // Fetch logged-in user data from the server
        async function fetchUserData() {
          try {
            const userId = localStorage.getItem("userId"); // Get user ID from localStorage
            const response = await fetch(`${API_URL}/${userId}`);
            const data = await response.json();
            document.getElementById("name").textContent = data.name;
            document.getElementById("phone").textContent = data.phone;
            document.getElementById("address").textContent = data.address;
            // document.getElementById('bio').textContent = data.bio;
          } catch (error) {
            console.error("Error fetching user data:", error);
          }
        }

        // Update user data on the server
        async function updateUserData(userData) {
          try {
            const userId = localStorage.getItem("userId"); // Get user ID from localStorage
            const response = await fetch(`${API_URL}/${userId}`, {
              method: "PATCH", // Use PATCH for updating the resource
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(userData),
            });
            if (!response.ok) {
              throw new Error("Failed to update user data");
            }
            // Reflect the changes in the UI
            document.getElementById("name").textContent = userData.name;
            document.getElementById("phone").textContent = userData.phone;
            document.getElementById("address").textContent = userData.address;
            // document.getElementById('bio').textContent = userData.bio;
            updateForm.style.display = "none";
            cancelButton.style.display = "none";
            updateButton.style.display = "inline-block";
          } catch (error) {
            console.error("Error updating user data:", error);
          }
        }

        updateButton.addEventListener("click", () => {
          updateForm.style.display = "block";
          cancelButton.style.display = "inline-block";
          updateButton.style.display = "none";
          logoutButton.style.display = "none";
          const nameSpan = document.getElementById("name");
          const phoneSpan = document.getElementById("phone");
          const addressSpan = document.getElementById("address");
          // const bioSpan = document.getElementById('bio');
          document.getElementById("name-input").value = nameSpan.textContent;
          document.getElementById("password-input").value = ""; // Password is not displayed for security reasons
          document.getElementById("phone-input").value = phoneSpan.textContent;
          document.getElementById("address-input").value =
            addressSpan.textContent;
          // document.getElementById('bio-input').value = bioSpan.textContent;
        });

        cancelButton.addEventListener("click", () => {
          updateForm.style.display = "none";
          cancelButton.style.display = "none";
          updateButton.style.display = "inline-block";
          logoutButton.style.display = "inline-block";
        });

        updateForm.addEventListener("submit", (event) => {
          event.preventDefault();
          const userData = {
            name: document.getElementById("name-input").value,
            password: document.getElementById("password-input").value,
            phone: document.getElementById("phone-input").value,
            address: document.getElementById("address-input").value,
            // bio: document.getElementById('bio-input').value
          };
          updateUserData(userData);
        });

        logoutButton.addEventListener("click", () => {
          localStorage.removeItem("userId"); // Remove user ID from localStorage
          window.location.href = "index.html"; // Redirect to login page
        });

        // Fetch user data on page load
        fetchUserData();
      });
    </script>
  </body>
</html>
